# 聊聊java反射

## 一：开头小菜

> 反射算是一个比较高阶的操作了，虽然他会影响性能，但是一些场景下我们还只可以使用反射来完成
>
> 反射实际上就是通过JDK加载一个Class文件之后对外提供的一个接口对象`Class对象`，我们可以根据这个Class对象获取这个类的所有信息
>
> 同时要知道动态编译以及静态编译
>
> - **静态编译：** 在编译时确定类型，绑定对象
> - **动态编译：** 运行时确定类型，绑定对象
>
> 两者的区别在于，动态编译可以最大程度地支持多态，而多态最大的意义在于降低类的耦合性，因此反射的优点就很明显了：解耦以及提高代码的灵活性。

- 获取Class对象四种方法简单说下

~~~java
1. Class clazz = Object.class;
	// >通过此方式获取Class对象不会进行初始化
2. Class clazz = Class.forName("java.lang.Object");//类的全限定类名
	//forName方法两个，一是只有这个参数，表示初始化获取的类，二是传入第二个布尔值，表示是否初始化，第三个是要给他一个类加载器
3. Class clazz = instance.getClass();//instance是一个类的实例对象
	//首先肯定要执行构造方法，也会执行静态代码块(只会执行一次，如果前面执行过将不再执行)与动态代码块
4. Class clazz = classLoader.loadClass("java.lang.Object");//classLoader是一个某个类的类	加载器，加载类中传入类的全限定类名，使用很少
//不同的方式对类的加载程度不同，做个总结
/**
（1）类名.class：JVM将使用类装载器，将类装入内存(前提是:类还没有装入内存)，不做类的初始化工作，返回Class的对象。
（2）Class.forName("类名字符串")：装入类，并做类的静态初始化，返回Class的对象。
（3）实例对象.getClass()：对类进行静态初始化、非静态初始化；返回引用运行时真正所指的对象(子对象的引用会赋给父对象的引用变量中)所属的类的Class的对象。
*/
~~~

**使用Class对象获取类的内容不是我们这次谈的地方，我们要谈一下他的优缺点以及应用场景**

## 二：优缺点

> - **优点：** 运行期类型的判断，动态加载类，提高代码灵活度。
>
> - **缺点：**
>
>   1 ,  性能瓶颈：反射相当于一系列解释操作，通知 JVM 要做的事情，性能比直接的 java 代码要慢很多。
>
>   2 ,  安全问题，让我们可以动态操作改变类的属性同时也增加了类的安全隐患。

## 三：应用场景

**先来一句话：反射是框架设计的灵魂**

> 在我们平时的项目开发过程中，基本上很少会直接使用到反射机制，但这不能说明反射机制没有用，实际上有很多设计、开发都与反射机制有关，例如模块化的开发，通过反射去调用对应的字节码；动态代理设计模式也采用了反射机制，还有我们日常使用的 Spring／Hibernate 等框架也大量使用到了反射机制。
>
> 举例：
>
> 1. 我们在使用 JDBC 连接数据库时使用 `Class.forName()`通过反射加载数据库的驱动程序；
> 2. Spring 框架的 IOC（动态加载管理 Bean）创建对象以及 AOP（动态代理）功能都和反射有联系；
> 3. 动态配置实例的属性；



**举个例子看看spring的其中一个使用**

> Spring 通过 XML 配置模式装载 Bean 的过程：
>
> 1. 将程序内所有 XML 或 Properties 配置文件加载入内存中
> 2. Java类里面解析xml或properties里面的内容，得到对应实体类的字节码字符串以及相关的属性信息
> 3. 使用反射机制，根据这个字符串获得某个类的Class实例
> 4. 动态配置实例的属性
>
> Spring这样做的好处是：
>
> - 不用每一次都要在代码里面去new或者做其他的事情
> - 以后要改的话直接改配置文件，代码维护起来就很方便了
> - 有时为了适应某些需求，Java类里面不一定能直接调用另外的方法，可以通过反射机制来实现